<div class="container-fluid">
  <app-page-header
    [title]="data.title"
    [subtitle]="data.subtitle"
    [name]="data.name"
  ></app-page-header>

  <div class="row mb-5">
    <div class="col-12">
      <div class="card-box">
        <h3 class="text-center mb-3">Lista de Usuarios con sus Roles</h3>

        <div class="table-responsive">
          <table
            id="table-usuarios"
            class="table table-bordered table-hover mb-0 dts"
          >
            <thead class="bg-dark text-center text-white text-nowrap">
              <tr style="cursor: pointer">
                <th scope="col">Id</th>
                <th scope="col">Usuario</th>
                <th scope="col">Roles</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr
                *ngFor="let usuario of usuarios; let i = index"
                class="text-nowrap text-center"
              >
                <th scope="row" class="align-middle" style="min-width: 80px">
                  {{ usuario.userId }}
                </th>
                <td class="align-middle">{{ usuario.fullname }}</td>
                <td class="align-middle text-wrap">
                  <div class="d-flex flex-wrap justify-content-center">
                    <ng-container
                      *ngIf="
                        usuario.roles && usuario.roles.length > 0;
                        else noPermisos
                      "
                    >
                      <span
                        *ngFor="let rol of usuario.roles"
                        class="px-3 py-1 mr-1 mb-1 bg-dark text-white rounded shadow-sm text-sm"
                      >
                        {{ rol.nombre_Rol }}
                      </span>
                    </ng-container>
                    <ng-template #noPermisos>
                      <span class="text-muted">No tiene roles asignados</span>
                    </ng-template>
                  </div>
                </td>
                <td class="align-middle text-nowrap" style="min-width: 170px">
                  <div class="d-flex justify-content-center">
                    <button
                      title="Asignar permisos"
                      class="btn btn-sm btn-primary mr-1"
                      (click)="asignarRoles(usuario.userId!)"
                    >
                      Asignar Permisos
                    </button>
                  </div>
                </td>
              </tr>
              <tr *ngIf="usuarios.length === 0">
                <td colspan="4" class="text-center">
                  No hay usuarios registrados
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
